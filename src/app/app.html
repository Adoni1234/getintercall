<mat-card class="main-card">
  <mat-card-header>
    <mat-card-title>GetIntercall - TranscripciÃ³n Real-Time</mat-card-title>
    <mat-card-subtitle>
      DetecciÃ³n automÃ¡tica de inglÃ©s y espaÃ±ol
      <span *ngIf="bloques.length > 0" class="block-counter"> â€¢ {{bloques.length}} bloque{{bloques.length !== 1 ? 's' : ''}}</span>
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div class="button-group">
      <button mat-raised-button color="primary" (click)="startRecording()" [disabled]="isRecording">
        ğŸ™ï¸ Iniciar
      </button>
      <button mat-raised-button color="warn" (click)="stopRecording()" [disabled]="!isRecording">
        ğŸ›‘ Detener
      </button>
      <button mat-raised-button color="accent" (click)="clearTranscription()" [disabled]="!isRecording || bloques.length === 0">
        ğŸ§¹ Limpiar
      </button>
    </div>

    <mat-progress-spinner *ngIf="loading" mode="indeterminate" diameter="50"></mat-progress-spinner>

    <div class="transcription-container" #scrollMe (scroll)="onContainerScroll($event)">
      <!-- Definitive blocks -->
      <div *ngFor="let bloque of bloques; let i = index" 
           class="bloque definitivo" 
           [attr.data-lang]="bloque.lang">
        <p class="lang" [attr.data-lang]="bloque.lang">
          {{ bloque.lang === 'es' ? 'ğŸ‡ªğŸ‡¸ EspaÃ±ol' : 'ğŸ‡ºğŸ‡¸ English' }}
        </p>
        <p class="text">{{ bloque.text }}</p>
        <small class="timestamp">Bloque {{ i + 1 }}</small>
      </div>
      
      <!-- Current partial block -->
      <div *ngIf="currentPartial.text.trim()" 
           class="bloque temporal" 
           [attr.data-lang]="currentPartial.lang"
           [ngClass]="{ 'no-pulse': !autoScrollEnabled }">
        <p class="lang" [attr.data-lang]="currentPartial.lang">
          {{ currentPartial.lang === 'es' ? 'ğŸ‡ªğŸ‡¸ EspaÃ±ol' : 'ğŸ‡ºğŸ‡¸ English' }} - Escuchando...
        </p>
        <p class="text">{{ currentPartial.text }}</p>
        <small class="status">â— En vivo</small>
      </div>
      
      <!-- Empty states -->
      <div *ngIf="loading && bloques.length === 0 && !currentPartial.text" class="loading">
        ğŸ§ Escuchando audio de pestaÃ±a...
      </div>
      <div *ngIf="isRecording && bloques.length === 0 && !currentPartial.text && !loading" class="empty">
        Esperando audio para transcribir...
      </div>
      <div *ngIf="!isRecording && bloques.length === 0 && !currentPartial.text" class="empty">
        Presiona "ğŸ™ï¸ Iniciar" para comenzar la transcripciÃ³n
      </div>
    </div>
  </mat-card-content>
</mat-card>